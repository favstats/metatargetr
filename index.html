<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Retrieve and Parse Meta Ad Targeting Data ‚Ä¢ metatargetr</title>
<script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet">
<link href="deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Retrieve and Parse Meta Ad Targeting Data">
<meta name="description" content="The metatargetr package provides tools for retrieving, parsing, and analyzing advertising targeting data from Meta‚Äôs Ad Library and Audience Tab.">
<meta property="og:description" content="The metatargetr package provides tools for retrieving, parsing, and analyzing advertising targeting data from Meta‚Äôs Ad Library and Audience Tab.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">metatargetr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.10</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/favstats/metatargetr" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="metatargetr-">metatargetr <img src="reference/figures/metatargetr_logo.png" width="160px" align="right"><a class="anchor" aria-label="anchor" href="#metatargetr-"></a>
</h1></div>
<!-- README.md is generated from README.Rmd. Please edit that file -->
<!-- badges: start -->

<p>The goal of <code>metatargetr</code> is to parse targeting information from the <a href="https://developers.facebook.com/docs/fort-ads-targeting-dataset/" class="external-link">Meta Ad Targeting dataset</a> and retrieve data from the <a href="https://www.facebook.com/ads/library/?active_status=all&amp;ad_type=political_and_issue_ads&amp;country=NL&amp;view_all_page_id=175740570505&amp;sort_data%5Bdirection%5D=desc&amp;sort_data%5Bmode%5D=relevancy_monthly_grouped&amp;search_type=page&amp;media_type=all" class="external-link">Audience tab</a> in the Meta Ad Library. It also includes helper functions for Meta ad library data and integrates data from the Google Transparency Report.</p>
<p>üí° <em>Support Open-Source Development</em></p>
<p>If <code>metatargetr</code> has been helpful to you, consider <a href="https://www.buymeacoffee.com/favstats" class="external-link">supporting the project</a>! Every contribution keeps the maintenance work going and helps me develop new features üòä</p>
<div style="text-align: right;">
<p><a href="https://www.buymeacoffee.com/favstats" target="_blank" class="external-link"> <img src="https://img.buymeacoffee.com/button-api/?text=Buy%20me%20a%20coffee&amp;emoji=&amp;slug=favstats&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Arial&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="Buy Me a Coffee" style="height: 40px; width: auto;"></a></p>
</div>
<hr>
<div class="section level2">
<h2 id="table-of-contents">Table of Contents<a class="anchor" aria-label="anchor" href="#table-of-contents"></a>
</h2>
<ul>
<li>üöÄ <a href="#installation">Installation</a>
</li>
<li>üì¶ <a href="#load-in-package">Load in Package</a>
</li>
<li>üéØ <a href="#get-targeting-criteria-last-30-days">Get Targeting Criteria</a>
<ul>
<li>‚è≥ <a href="#get-targeting-criteria-last-30-days">Last 30 Days</a>
</li>
<li>üóìÔ∏è <a href="#get-targeting-criteria-last-7-days">Last 7 Days</a>
</li>
</ul>
</li>
<li>üï∞Ô∏è <a href="#retrieve-historical-targeting-data-from-database">Retrieve Historical Targeting Data</a>
</li>
<li>üóÇÔ∏è <a href="#retrieve-historical-report-data-from-the-database">Retrieve Historical Report Data</a>
</li>
<li>‚ÑπÔ∏è <a href="#get-page-info">Get Page Info</a>
</li>
<li>üîç <a href="#retrieve-targeting-metadata">Retrieve Targeting Metadata</a>
</li>
<li>üñºÔ∏è <a href="#get-ad-snapshots-images-videos-and-metadata">Get Ad Snapshots (Images, Videos, and Metadata)</a>
<ul>
<li><a href="#single-ad">Single ad</a></li>
<li><a href="#batch-processing-recommended-for-multiple-ads">Batch processing</a></li>
<li><a href="#download-media-files">Download media files</a></li>
</ul>
</li>
<li>üìÑ <a href="#fetch-and-cache-ad-html">Fetch and Cache Ad HTML</a>
</li>
<li>üîó <a href="#get-deeplink-data">Get Deeplink Data</a>
</li>
<li>üìä <a href="#google-transparency-report">Google Transparency Report</a>
<ul>
<li>üí∞ <a href="#retrieve-aggregated-spending-data">Retrieve Aggregated Spending Data</a>
</li>
<li>üìà <a href="#retrieve-time-based-spending-data">Retrieve Time-Based Spending Data</a>
</li>
</ul>
</li>
<li>‚úçÔ∏è <a href="#citing-metatargetr">Citing metatargetr</a>
</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of metatargetr like so:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"favstats/metatargetr"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-in-package">Load in Package<a class="anchor" aria-label="anchor" href="#load-in-package"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/favstats/metatargetr" class="external-link">metatargetr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get-targeting-criteria-last-30-days">Get Targeting Criteria (Last 30 Days)<a class="anchor" aria-label="anchor" href="#get-targeting-criteria-last-30-days"></a>
</h2>
<p>The following code retrieves the targeting criteria used by the main page of the VVD (Dutch party) in the last 30 days of available data.</p>
<p>Just put in the right <em>Page ID</em>. These can be found in the <a href="https://www.facebook.com/ads/library/" class="external-link">Meta Ad Library</a> or the <a href="https://www.facebook.com/ads/library/report/" class="external-link">Meta Ad Library Report</a>. You can also <a href="#retrieve-historical-report-data-from-the-database">retrieve historical report data</a> from the maintained database.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">last30</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_targeting.html">get_targeting</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"121264564551002"</span>, </span>
<span>                        timeframe <span class="op">=</span> <span class="st">"LAST_30_DAYS"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">last30</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 0 √ó 7</span></span>
<span><span class="co">#&gt; # ‚Ñπ 7 variables: ds &lt;chr&gt;, main_currency &lt;chr&gt;, total_num_ads &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   total_spend_formatted &lt;chr&gt;, is_30_day_available &lt;lgl&gt;,</span></span>
<span><span class="co">#&gt; #   is_90_day_available &lt;lgl&gt;, page_id &lt;chr&gt;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get-targeting-criteria-last-7-days">Get Targeting Criteria (Last 7 Days)<a class="anchor" aria-label="anchor" href="#get-targeting-criteria-last-7-days"></a>
</h2>
<p>The following code retrieves the targeting criteria used by the main page of the VVD (Dutch party) in the last 7 days. Just put in the right Page ID.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">last7</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_targeting.html">get_targeting</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"121264564551002"</span>, </span>
<span>                       timeframe <span class="op">=</span> <span class="st">"LAST_7_DAYS"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">last7</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 0 √ó 7</span></span>
<span><span class="co">#&gt; # ‚Ñπ 7 variables: ds &lt;chr&gt;, main_currency &lt;chr&gt;, total_num_ads &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   total_spend_formatted &lt;chr&gt;, is_30_day_available &lt;lgl&gt;,</span></span>
<span><span class="co">#&gt; #   is_90_day_available &lt;lgl&gt;, page_id &lt;chr&gt;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="retrieve-historical-targeting-data-from-database">Retrieve <em>Historical</em> Targeting Data from Database<a class="anchor" aria-label="anchor" href="#retrieve-historical-targeting-data-from-database"></a>
</h2>
<p>Unfortunately, using <code>get_targeting</code> <strong>you can only get the targeting criteria in the last 7, 30, and 90 days windows</strong>. However, I have set up scrapers that retrieve the daily targeting data for every single page in the world that runs advertisements in order to archive this data. You can use the function below to retrieve it.</p>
<blockquote>
<p>Be aware: sometimes the scrapers do not work so it is possible that some pages are missing. You can use <a href="#get-targeting-metadata"><code>get_targeting_metadata</code></a> function to check which data for which country and day is present.</p>
</blockquote>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># # set some parameters</span></span>
<span><span class="va">the_cntry</span> <span class="op">&lt;-</span> <span class="st">"DE"</span></span>
<span><span class="va">tf</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="st">"2024-10-25"</span></span>
<span></span>
<span><span class="co"># # Call the function</span></span>
<span><span class="va">latest_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_targeting_db.html">get_targeting_db</a></span><span class="op">(</span><span class="va">the_cntry</span>, <span class="va">tf</span>, <span class="va">ds</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># # Inspect the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">latest_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 √ó 37</span></span>
<span><span class="co">#&gt;   internal_id no_data tstamp              page_id  cntry page_name partyfacts_id</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;lgl&gt;   &lt;dttm&gt;              &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;        </span></span>
<span><span class="co">#&gt; 1 &lt;NA&gt;        NA      2024-10-27 19:12:35 7440553‚Ä¶ DE    CDU-Frak‚Ä¶ 1375         </span></span>
<span><span class="co">#&gt; 2 &lt;NA&gt;        NA      2024-10-27 19:12:35 7440553‚Ä¶ DE    CDU-Frak‚Ä¶ 1375         </span></span>
<span><span class="co">#&gt; 3 &lt;NA&gt;        NA      2024-10-27 19:12:35 7440553‚Ä¶ DE    CDU-Frak‚Ä¶ 1375         </span></span>
<span><span class="co">#&gt; 4 &lt;NA&gt;        NA      2024-10-27 19:12:35 7440553‚Ä¶ DE    CDU-Frak‚Ä¶ 1375         </span></span>
<span><span class="co">#&gt; 5 &lt;NA&gt;        NA      2024-10-27 19:12:35 7440553‚Ä¶ DE    CDU-Frak‚Ä¶ 1375         </span></span>
<span><span class="co">#&gt; 6 &lt;NA&gt;        NA      2024-10-27 19:12:35 7440553‚Ä¶ DE    CDU-Frak‚Ä¶ 1375         </span></span>
<span><span class="co">#&gt; # ‚Ñπ 30 more variables: sources &lt;chr&gt;, country &lt;chr&gt;, party &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   left_right &lt;dbl&gt;, tags &lt;glue&gt;, tags_ideology &lt;chr&gt;, disclaimer &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   amount_spent_eur &lt;chr&gt;, number_of_ads_in_library &lt;chr&gt;, date &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   path &lt;chr&gt;, tf &lt;chr&gt;, remove_em &lt;lgl&gt;, total_n &lt;int&gt;, amount_spent &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   value &lt;chr&gt;, num_ads &lt;int&gt;, total_spend_pct &lt;dbl&gt;, type &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   location_type &lt;chr&gt;, num_obfuscated &lt;int&gt;, is_exclusion &lt;lgl&gt;, ds &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   main_currency &lt;chr&gt;, total_num_ads &lt;int&gt;, total_spend_formatted &lt;dbl&gt;, ‚Ä¶</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="retrieve-historical-report-data-from-the-database">Retrieve <em>Historical</em> Report Data from the Database<a class="anchor" aria-label="anchor" href="#retrieve-historical-report-data-from-the-database"></a>
</h2>
<p>Using <code>get_report_db</code>, you can retrieve archived advertising reports for specific pages, countries, and timeframes. Reports are stored in a repository and can be downloaded and read directly into R.</p>
<blockquote>
<p>Note: While we strive to keep the archive complete, occasional scraper failures may lead to missing data for certain days.</p>
</blockquote>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># # set some parameters</span></span>
<span><span class="va">the_cntry</span> <span class="op">&lt;-</span> <span class="st">"DE"</span></span>
<span><span class="va">tf</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="st">"2024-10-25"</span></span>
<span></span>
<span><span class="co"># # Call the function</span></span>
<span><span class="va">latest_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_report_db.html">get_report_db</a></span><span class="op">(</span><span class="va">the_cntry</span>, <span class="va">tf</span>, <span class="va">ds</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># # Inspect the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">latest_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 √ó 9</span></span>
<span><span class="co">#&gt;   page_id     page_name disclaimer amount_spent_eur number_of_ads_in_lib‚Ä¶¬π date </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;            &lt;chr&gt;                  &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 2781178155‚Ä¶ EU Justi‚Ä¶ EU Justic‚Ä¶ 296508           28                     2024‚Ä¶</span></span>
<span><span class="co">#&gt; 2 1706886445‚Ä¶ UNICEF D‚Ä¶ UNICEF De‚Ä¶ 78283            79                     2024‚Ä¶</span></span>
<span><span class="co">#&gt; 3 1891313609‚Ä¶ LIQID In‚Ä¶ LIQID Inv‚Ä¶ 76300            88                     2024‚Ä¶</span></span>
<span><span class="co">#&gt; 4 1918513976‚Ä¶ VETO ‚Äì T‚Ä¶ VETO - Ti‚Ä¶ 71581            218                    2024‚Ä¶</span></span>
<span><span class="co">#&gt; 5 23216224900 Plan Int‚Ä¶ Plan Inte‚Ä¶ 62605            62                     2024‚Ä¶</span></span>
<span><span class="co">#&gt; 6 1612732458‚Ä¶ Save the‚Ä¶ Save the ‚Ä¶ 59891            195                    2024‚Ä¶</span></span>
<span><span class="co">#&gt; # ‚Ñπ abbreviated name: ¬π‚Äãnumber_of_ads_in_library</span></span>
<span><span class="co">#&gt; # ‚Ñπ 3 more variables: path &lt;chr&gt;, tf &lt;chr&gt;, cntry &lt;chr&gt;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get-page-info">Get Page Info<a class="anchor" aria-label="anchor" href="#get-page-info"></a>
</h2>
<p>You can also retrieve some page info of the page that you are interested in.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">page_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_page_insights.html">get_page_insights</a></span><span class="op">(</span><span class="st">"121264564551002"</span>, include_info <span class="op">=</span> <span class="st">"page_info"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">page_info</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    1 obs. of  20 variables:</span></span>
<span><span class="co">#&gt;  $ page_name             : chr "VVD"</span></span>
<span><span class="co">#&gt;  $ is_profile_page       : chr "FALSE"</span></span>
<span><span class="co">#&gt;  $ page_is_deleted       : chr "FALSE"</span></span>
<span><span class="co">#&gt;  $ page_is_restricted    : chr "FALSE"</span></span>
<span><span class="co">#&gt;  $ has_blank_ads         : chr "FALSE"</span></span>
<span><span class="co">#&gt;  $ hidden_ads            : chr "0"</span></span>
<span><span class="co">#&gt;  $ page_profile_uri      : chr "https://facebook.com/VVD"</span></span>
<span><span class="co">#&gt;  $ page_id               : chr "121264564551002"</span></span>
<span><span class="co">#&gt;  $ page_verification     : chr "BLUE_VERIFIED"</span></span>
<span><span class="co">#&gt;  $ entity_type           : chr "PERSON_PROFILE"</span></span>
<span><span class="co">#&gt;  $ page_alias            : chr "VVD"</span></span>
<span><span class="co">#&gt;  $ likes                 : chr "109676"</span></span>
<span><span class="co">#&gt;  $ page_category         : chr "Political party"</span></span>
<span><span class="co">#&gt;  $ ig_verification       : chr "TRUE"</span></span>
<span><span class="co">#&gt;  $ ig_username           : chr "vvd"</span></span>
<span><span class="co">#&gt;  $ ig_followers          : chr "54188"</span></span>
<span><span class="co">#&gt;  $ shared_disclaimer_info: chr "[]"</span></span>
<span><span class="co">#&gt;  $ about                 : chr "Een sterk en veilig Nederland. Met rust in je portemonnee en alle ruimte voor jou om te groeien en iets op te b"| __truncated__</span></span>
<span><span class="co">#&gt;  $ event                 : chr "CREATION: 2010-04-23 21:05:02"</span></span>
<span><span class="co">#&gt;  $ no_address            : logi TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get_targeting_metadata">
<code>get_targeting_metadata()</code><a class="anchor" aria-label="anchor" href="#get_targeting_metadata"></a>
</h2>
<p>The <code>get_targeting_metadata</code> function is designed to retrieve metadata about targeting data releases from a GitHub repository to see which data is present (or not). It extracts and organizes information such as file names, sizes, timestamps, and tags for a specified country and timeframe. <strong>This metadata provides an overview of the available targeting data without downloading the actual files.</strong></p>
<ul>
<li><p><code>country_code</code> (<em>Character</em>):<br>
The ISO country code (e.g., <code>"DE"</code> for Germany, <code>"US"</code> for the United States).</p></li>
<li>
<p><code>timeframe</code> (<em>Character</em>):<br>
The timeframe for the targeting data. Acceptable values are:</p>
<ul>
<li>
<code>"7"</code>: Last 7 days.</li>
<li>
<code>"30"</code>: Last 30 days.</li>
<li>
<code>"90"</code>: Last 90 days.</li>
</ul>
</li>
<li><p><code>base_url</code> (<em>Character</em>, default: <code>"https://github.com/favstats/meta_ad_targeting/releases/expanded_assets/"</code>):<br>
The base URL for the GitHub repository hosting the targeting data.</p></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Retrieve metadata for Germany for the last 30 days</span></span>
<span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_targeting_metadata.html">get_targeting_metadata</a></span><span class="op">(</span><span class="st">"DE"</span>, <span class="st">"30"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 695 √ó 3</span></span>
<span><span class="co">#&gt;    cntry ds         tframe      </span></span>
<span><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       </span></span>
<span><span class="co">#&gt;  1 DE    2026-02-15 last_30_days</span></span>
<span><span class="co">#&gt;  2 DE    2026-02-14 last_30_days</span></span>
<span><span class="co">#&gt;  3 DE    2026-02-13 last_30_days</span></span>
<span><span class="co">#&gt;  4 DE    2026-02-12 last_30_days</span></span>
<span><span class="co">#&gt;  5 DE    2026-02-11 last_30_days</span></span>
<span><span class="co">#&gt;  6 DE    2026-02-10 last_30_days</span></span>
<span><span class="co">#&gt;  7 DE    2026-02-09 last_30_days</span></span>
<span><span class="co">#&gt;  8 DE    2026-02-08 last_30_days</span></span>
<span><span class="co">#&gt;  9 DE    2026-02-07 last_30_days</span></span>
<span><span class="co">#&gt; 10 DE    2026-02-06 last_30_days</span></span>
<span><span class="co">#&gt; # ‚Ñπ 685 more rows</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get-ad-snapshots-images-videos-and-metadata">Get Ad Snapshots (Images, Videos, and Metadata)<a class="anchor" aria-label="anchor" href="#get-ad-snapshots-images-videos-and-metadata"></a>
</h2>
<p><code><a href="reference/get_ad_snapshots.html">get_ad_snapshots()</a></code> retrieves snapshot data for a Facebook ad from the Ad Library, including images, videos, cards, body text, page info, and more. It uses headless Chrome (via chromote) to bypass Facebook‚Äôs JavaScript-based bot detection.</p>
<p>This piece of code was created in collaboration with <a href="https://www.uva.nl/en/profile/m/e/p.m.mendoza/p.m.mendoza.html" class="external-link">Philipp Mendoza</a>.</p>
<div class="section level3">
<h3 id="single-ad">Single ad<a class="anchor" aria-label="anchor" href="#single-ad"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">snap</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_ad_snapshots.html">get_ad_snapshots</a></span><span class="op">(</span><span class="st">"561403598962843"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="batch-processing-recommended-for-multiple-ads">Batch processing (recommended for multiple ads)<a class="anchor" aria-label="anchor" href="#batch-processing-recommended-for-multiple-ads"></a>
</h3>
<p>For best performance when processing multiple ads, use a persistent browser session. This passes Facebook‚Äôs JS challenge once during startup, so all subsequent calls are fast.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/browser_session_start.html">browser_session_start</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/map_dfr_progress.html">map_dfr_progress</a></span><span class="op">(</span><span class="va">ad_ids</span>, <span class="op">~</span><span class="fu"><a href="reference/get_ad_snapshots.html">get_ad_snapshots</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/browser_session_close.html">browser_session_close</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>If Chrome becomes unresponsive mid-batch, use <code><a href="reference/browser_session_restart.html">browser_session_restart()</a></code> to recover without restarting R.</p>
</div>
<div class="section level3">
<h3 id="download-media-files">Download media files<a class="anchor" aria-label="anchor" href="#download-media-files"></a>
</h3>
<p>Setting <code>download = TRUE</code> saves images and videos to disk. Use <code>hashing = TRUE</code> to deduplicate media files (recommended for large-scale collection).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/get_ad_snapshots.html">get_ad_snapshots</a></span><span class="op">(</span><span class="st">"561403598962843"</span>, download <span class="op">=</span> <span class="cn">TRUE</span>, hashing <span class="op">=</span> <span class="cn">TRUE</span>, mediadir <span class="op">=</span> <span class="st">"data/media"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="fetch-and-cache-ad-html">Fetch and Cache Ad HTML<a class="anchor" aria-label="anchor" href="#fetch-and-cache-ad-html"></a>
</h2>
<p><code><a href="reference/get_ad_html.html">get_ad_html()</a></code> fetches the raw HTML for one or more ads and caches results to disk as gzipped files. Useful for archiving or downstream parsing with <code>parse_ad_htmls()</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_ad_html.html">get_ad_html</a></span><span class="op">(</span></span>
<span>  ad_ids  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"561403598962843"</span>, <span class="st">"1103135646905363"</span><span class="op">)</span>,</span>
<span>  country <span class="op">=</span> <span class="st">"US"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get-deeplink-data">Get Deeplink Data<a class="anchor" aria-label="anchor" href="#get-deeplink-data"></a>
</h2>
<p><code><a href="reference/get_deeplink.html">get_deeplink()</a></code> extracts the full <code>deeplinkAdCard</code> JSON object from an ad page, which contains additional metadata beyond what <code><a href="reference/get_ad_snapshots.html">get_ad_snapshots()</a></code> returns (e.g., <code>fevInfo</code>, <code>free_form_additional_info</code>, <code>learn_more_content</code>).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_deeplink.html">get_deeplink</a></span><span class="op">(</span><span class="st">"561403598962843"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="google-transparency-report">Google Transparency Report<a class="anchor" aria-label="anchor" href="#google-transparency-report"></a>
</h2>
<p><code>ggl_get_spending</code> is a function in R that queries the Google Transparency Report to retrieve information about advertising spending for a specified advertiser. It supports a range of countries and can provide either aggregated data or time-based spending data.</p>
<p>To use <code>ggl_get_spending</code>, you need the advertiser‚Äôs unique identifier, the desired date range, and the country code. The function also has an option to retrieve time-based spending data.</p>
<div class="section level3">
<h3 id="retrieve-aggregated-spending-data">Retrieve Aggregated Spending Data<a class="anchor" aria-label="anchor" href="#retrieve-aggregated-spending-data"></a>
</h3>
<p>Retrieve aggregated spending data for a specific advertiser in the Netherlands. It returns details like currency, number of ads, ad type breakdown, advertiser details, and other metrics.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="reference/ggl_get_spending.html">ggl_get_spending</a></span><span class="op">(</span>advertiser_id <span class="op">=</span> <span class="st">"AR18091944865565769729"</span>, </span>
<span>                 start_date <span class="op">=</span> <span class="st">"2023-10-24"</span>, </span>
<span>                 end_date <span class="op">=</span> <span class="st">"2023-11-22"</span>,</span>
<span>                 cntry <span class="op">=</span> <span class="st">"NL"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 √ó 2</span></span>
<span><span class="co">#&gt;   spend number_of_ads</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     0             0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="retrieve-time-based-spending-data">Retrieve Time-Based Spending Data<a class="anchor" aria-label="anchor" href="#retrieve-time-based-spending-data"></a>
</h3>
<p>Retrieve time-based spending data for the same advertiser and country. If <code>get_times</code> is set to <code>TRUE</code>, it returns a tibble with date-wise spending data.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Retrieve time-based spending data for the same advertiser and country</span></span>
<span><span class="va">timeseries_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ggl_get_spending.html">ggl_get_spending</a></span><span class="op">(</span>advertiser_id <span class="op">=</span> <span class="st">"AR18091944865565769729"</span>,</span>
<span>                                   start_date <span class="op">=</span> <span class="st">"2023-10-24"</span>,</span>
<span>                                   end_date <span class="op">=</span> <span class="st">"2023-11-22"</span>,</span>
<span>                                   cntry <span class="op">=</span> <span class="st">"NL"</span>,</span>
<span>                                   get_times <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting the time-series data</span></span>
<span><span class="va">timeseries_dat</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">spend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="citing-metatargetr">Citing <code>metatargetr</code>
<a class="anchor" aria-label="anchor" href="#citing-metatargetr"></a>
</h2>
<p>If you use the <code>metatargetr</code> package or data from its database in your research, publications, or other outputs, please ensure you provide proper attribution. This helps recognize the effort and resources required to maintain and provide access to these data.</p>
<div class="section level3">
<h3 id="citation-format">Citation Format<a class="anchor" aria-label="anchor" href="#citation-format"></a>
</h3>
<blockquote>
<p>Votta, Fabio, &amp; Mendoza, Philipp. (2024). <code>metatargetr</code>: A package for parsing and analyzing ad library and targeting data. GitHub. Available at: <a href="https://github.com/favstats/metatargetr" class="external-link uri">https://github.com/favstats/metatargetr</a></p>
</blockquote>
</div>
<div class="section level3">
<h3 id="bibtex-entry">BibTeX Entry<a class="anchor" aria-label="anchor" href="#bibtex-entry"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode bibtex"><code class="sourceCode bibtex"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="va">@misc</span>{<span class="ot">votta2024metatargetr</span>,</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  <span class="dt">author</span> = {Votta, Fabio and Mendoza, Philipp},</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  <span class="dt">title</span> = {metatargetr: A package for parsing and analyzing ad library and targeting data},</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>  <span class="dt">year</span> = {2024},</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>  <span class="dt">publisher</span> = {GitHub},</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>  <span class="dt">url</span> = {https://github.com/favstats/metatargetr}</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="additional-notes">Additional Notes<a class="anchor" aria-label="anchor" href="#additional-notes"></a>
</h3>
<p>If you use data from the <code>metatargetr</code> database, please include the following acknowledgement in your work:</p>
<blockquote>
<p>Data were retrieved from the <code>metatargetr</code> database, maintained by Fabio Votta. The database archives targeting data from the Meta Ad Library and Google Transparency Report. For more information, visit <a href="https://github.com/favstats/metatargetr" class="external-link uri">https://github.com/favstats/metatargetr</a>.</p>
</blockquote>
<p>By including these citations and acknowledgements, you help support the continued development of <code>metatargetr</code> and its associated resources. Thank you for your collaboration!</p>
<hr>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/favstats/metatargetr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/favstats/metatargetr/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing metatargetr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Fabio Votta <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/YOUR-ORCID-ID" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Philipp Mendoza <br><small class="roles"> Author </small> <a href="https://orcid.org/YOUR-ORCID-ID" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing" class="external-link"><img src="https://img.shields.io/badge/lifecycle-maturing-lightblue.svg" alt="Lifecycle: maturing"></a></li>
<li><a href="https://CRAN.R-project.org/package=metatargetr" class="external-link"><img src="https://www.r-pkg.org/badges/version/metatargetr" alt="CRAN status"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Fabio Votta and Philipp Mendoza.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Built with ‚ù§Ô∏è and pkgdown.</p>
</div>

    </footer>
</div>





  </body>
</html>
