% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/search_ad_library.R
\name{search_ad_library}
\alias{search_ad_library}
\title{Search the Facebook Ad Library}
\usage{
search_ad_library(
  page_id = NULL,
  query = NULL,
  country = "ALL",
  ad_type = "all",
  active_status = "all",
  date_min = NULL,
  date_max = NULL,
  media_type = "all",
  publisher_platforms = NULL,
  content_languages = NULL,
  search_type = NULL,
  sort_mode = "total_impressions",
  sort_direction = "desc",
  max_pages = 1,
  wait_sec = 12
)
}
\arguments{
\item{page_id}{Character. Facebook page ID to search for all ads from
that page (e.g., \code{"52985377549"} for D66). Use this for targeted
searches of a specific advertiser. Mutually exclusive with \code{query}.}

\item{query}{Character. Text search query (e.g., \code{"Rob Jetten"},
\code{"coca-cola"}). Returns ads mentioning the query from any advertiser.
Mutually exclusive with \code{page_id}.}

\item{country}{Character. ISO country code filter (default \code{"ALL"}).
Use \code{"NL"} for Netherlands, \code{"US"} for United States, etc.}

\item{ad_type}{Character. Ad type filter (default \code{"all"}).
Options: \code{"all"}, \code{"political_and_issue_ads"}.}

\item{active_status}{Character. Delivery status filter (default \code{"all"}).
Options: \code{"all"}, \code{"active"}, \code{"inactive"}.}

\item{date_min}{Character or NULL. Minimum start date filter in
\code{YYYY-MM-DD} format. Maps to \code{start_date[min]} in the Ad Library URL.}

\item{date_max}{Character or NULL. Maximum start date filter in
\code{YYYY-MM-DD} format. Maps to \code{start_date[max]} in the Ad Library URL.}

\item{media_type}{Character. Media type filter (default \code{"all"}).
Common options: \code{"all"}, \code{"image"}, \code{"video"}.}

\item{publisher_platforms}{Character vector or NULL. Platform filters.
Example: \code{c("facebook", "instagram")}.}

\item{content_languages}{Character vector or NULL. Content language filters.
Example: \code{c("nl", "en")}.}

\item{search_type}{Character or NULL. Search type override.
Common options: \code{"keyword_unordered"}, \code{"keyword_exact_phrase"}, \code{"page"}.
If \code{NULL} (default), inferred from \code{page_id}/\code{query}.}

\item{sort_mode}{Character or NULL. Sort mode for \code{sort_data[mode]}.
Default \code{"total_impressions"}.}

\item{sort_direction}{Character or NULL. Sort direction for
\code{sort_data[direction]}. Default \code{"desc"}.}

\item{max_pages}{Integer. Number of pages to fetch, each containing
~30 ads (default 1). Set higher to paginate (experimental).}

\item{wait_sec}{Numeric. Seconds to wait for the page to load
(default 12). Increase if getting empty results.}
}
\value{
A tibble with one row per ad. Returns an empty tibble if no
ads are found. See \strong{Data returned} section for column details.
}
\description{
Retrieves ads from the Facebook Ad Library by page ID or text query,
\strong{without requiring an API key}. Uses headless Chrome to load the
Ad Library search page, which embeds ~30 ads with rich metadata in its
server-side rendered HTML.
}
\details{
\subsection{Data returned}{

Each ad includes:
\itemize{
\item \strong{Metadata}: \code{ad_archive_id}, \code{page_name}, \code{page_id}, \code{categories}
(e.g., \code{"POLITICAL"}), \code{is_active}, \code{start_date}, \code{end_date}, \code{spend},
\code{currency}, \code{reach_estimate}, \code{publisher_platform}, \code{impressions_lower},
\code{impressions_upper}, \code{targeted_countries}
\item \strong{Creative (snapshot)}: \code{body}, \code{title}, \code{display_format}, \code{link_url},
\code{cta_text}, \code{images}, \code{videos}, \code{cards}, \code{page_profile_picture_url}
\item \strong{Link}: \code{ad_library_url} â€” direct URL to the ad in Facebook's Ad Library
}
}

\subsection{Important notes}{
\itemize{
\item Uses \code{active_status="all"} by default (full history)
\item Use \code{active_status="active"} to focus on ads currently running
\item Each page load yields ~30 ads from the server-side rendered HTML
\item Pagination beyond page 1 reuses Facebook's own pagination request shape
captured from browser runtime (still experimental)
\item The \code{categories} field can identify political ads (\code{"POLITICAL"})
}
}
}
\examples{
\dontrun{
browser_session_start()

# Search by page ID (all D66 ads)
d66_ads <- search_ad_library(page_id = "52985377549")

# Search by keyword in the Netherlands
ads <- search_ad_library(query = "Rob Jetten", country = "NL")

# Check which ads are political
ads \%>\% dplyr::filter(categories == "POLITICAL")

# Check ad dates and spend
ads \%>\% dplyr::select(page_name, start_date, end_date, spend, categories)

browser_session_close()
}
}
